---
title: "Examining the Relationship Between The Big-5 Personality Facets and Implicit Racial Attitudes"
subtitle: "Data Analysis"
author: "Andr√© Minder"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: hide
    highlight: haddock
    theme: flatly
    toc: yes
    toc_float: yes
---

```{r, include=FALSE}

# set knit options
knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE)

# disable scientific notation
options(scipen = 999) 

```

# Dependencies

```{r}

library(tidyverse)        # for general data wrangling/tidying and ggplot
library(knitr)            # for printing nice tables
library(kableExtra)       # for printing nice tables
library(janitor)          # for general data wrangling/tidying (rounding numbers)     
library(easystats)        # for reporting analyses results
library(scales)           # nicer plots (pretty breaks)
library(wesanderson)      # nicer plot colors
library(patchwork)        # for adding plots together

```

# Data

Load the processed data and apply the master exclusions.

```{r}

data_processed <- read_csv("../data/processed/data_processed.csv")

data_processed_after_exclusions <- data_processed |>
  filter(exclude_participant == "include")

```

# Sample Descriptives

Get important sample descriptives like sample size, age, gender, etc.

## Sample Size Before Exclusions

Sample size before master exclusions are applied.

```{r}

data_processed |>
  count(name = "n") |>
  kable() |>
  add_header_above(header = c("Whole sample" = 1)) |> 
  kable_classic(full_width = FALSE)

```

## Sample Size After Exclusions

Sample size after master exclusions are applied. This sample is used for the subsequent analyses.

```{r}

data_processed_after_exclusions |>
  count(name = "n") |>
  kable() |>
  add_header_above(header = c("For analysis" = 1)) |>
  kable_classic(full_width = FALSE)

```

## Age

Age descriptives of the analysis sample.
```{r}

data_processed_after_exclusions |>
  mutate(age = as.numeric(age)) |>
  summarise(Mean = mean(age, na.rm = TRUE),
            SD = sd(age, na.rm = TRUE)) |>
  mutate_all(.funs = janitor::round_half_up, digits = 1) |>
  kable() |>
  add_header_above(header = c("Age" = 2)) |>
  kable_classic(full_width = FALSE)

```

## Gender

Gender descriptives of the analysis sample. 
```{r}

data_processed_after_exclusions |> 
  rename(Sex = sex) |>
  group_by(Sex) |> 
  summarise(n = n()) |> 
  mutate(Percent = paste0(round_half_up((n / sum(n)) * 100, 1), "%")) |>
  mutate(Sex = stringr::str_to_sentence(Sex)) |> 
  kable() |>
  kable_classic(full_width = FALSE)

```

## Available Demographics Data

Proportion of the available demographics data in the analysis. Some participants have missing demographics data, because providing it was optional.

```{r}

data_processed_after_exclusions |> 
  select(age, sex) |> 
  mutate(age = as.numeric(age)) |> # cast strings (missing/error/others) back to NA
  mutate(sex = na_if(sex, "missing/error/others")) |> # do the same for the gender variable
  summarise_all(list(~sum(!is.na(.))/length(.))) |> # get the proportion of NA values in both variables
  rename(Age = age,
         Sex = sex) |> 
  mutate_all(.funs = janitor::round_half_up, digits = 2) |>
  kable() |>
  add_header_above(header = c("Proportion of Complete Data" = 2)) |>
  kable_classic(full_width = FALSE)

```


# Descriptive Plots/Statistics

This section contains descriptive statistics and plots for the BFI and the IAT. More specifically:

- Cronbach's alpha for the single BFI facets
- Descriptive plots (histograms) for all BFI facets and the IAT D-score
- Correlation matrix for the BFI facets and the IAT D-score

## BFI

### Cronbach's alpha

#### Agreeablessness
```{r}

psych::alpha(subset(data_processed_after_exclusions, select = c(bfi_a1:bfi_a9)))

```
#### Conscientiousness

```{r}

psych::alpha(subset(data_processed_after_exclusions, select = c(bfi_c1:bfi_c9)))

```

#### Extroversion

```{r}

psych::alpha(subset(data_processed_after_exclusions, select = c(bfi_e1:bfi_e8)))

```

#### Neuroticism

```{r}

psych::alpha(subset(data_processed_after_exclusions, select = c(bfi_n1:bfi_n8)))

```

#### Openness

```{r}

psych::alpha(subset(data_processed_after_exclusions, select = c(bfi_o1:bfi_o10)))

```


### Descriptive Plots

```{r} 

# Histogram for mean agreeableness (BFI)
ggplot(data_processed_after_exclusions, aes(x = bfi_mean_a)) +
  geom_histogram(binwidth = 1,
                 boundary = 0,
                 fill = viridis_pal(begin = 0.45, option = "mako")(1), 
                 color = viridis_pal(begin = 0.30, option = "mako")(1)) + 
  xlab("Mean Agreeableness") +
  ylab("Frequency") +
  theme_linedraw() +
  scale_x_continuous(breaks = pretty_breaks(n = 5)) +
  ggtitle("Histogram for BFI Agreeableness") +
  coord_cartesian(xlim = c(1, 6)) +
  theme(panel.grid.minor = element_blank())

# Histogram for mean conscientiousness (BFI)
ggplot(data_processed_after_exclusions, aes(x = bfi_mean_c)) +
  geom_histogram(binwidth = 1,
                 boundary = 0,
                 fill = viridis_pal(begin = 0.45, option = "mako")(1), 
                 color = viridis_pal(begin = 0.30, option = "mako")(1)) + 
  xlab("Mean Conscientiousness") +
  ylab("Frequency") +
  theme_linedraw() +
  scale_x_continuous(breaks = pretty_breaks(n = 5)) +
  ggtitle("Histogram for BFI Conscientiousness") +
  coord_cartesian(xlim = c(1, 6)) +
  theme(panel.grid.minor = element_blank())

# Histogram for mean extroversion (BFI)
ggplot(data_processed_after_exclusions, aes(x = bfi_mean_e)) +
  geom_histogram(binwidth = 1,
                 boundary = 0,
                 fill = viridis_pal(begin = 0.45, option = "mako")(1), 
                 color = viridis_pal(begin = 0.30, option = "mako")(1)) + 
  xlab("Mean Extroversion") +
  ylab("Frequency") +
  theme_linedraw() +
  scale_x_continuous(breaks = pretty_breaks(n = 5)) +
  ggtitle("Histogram for BFI Extroversion") +
  coord_cartesian(xlim = c(1, 6)) +
  theme(panel.grid.minor = element_blank())

# Histogram for mean neuroticism (BFI)
ggplot(data_processed_after_exclusions, aes(x = bfi_mean_n)) +
  geom_histogram(binwidth = 1,
                 boundary = 0,
                 fill = viridis_pal(begin = 0.45, option = "mako")(1), 
                 color = viridis_pal(begin = 0.30, option = "mako")(1)) + 
  xlab("Mean Neuroticism") +
  ylab("Frequency") +
  theme_linedraw() +
  scale_x_continuous(breaks = pretty_breaks(n = 5)) +
  ggtitle("Histogram for BFI Neuroticism") +
  coord_cartesian(xlim = c(1, 6)) +
  theme(panel.grid.minor = element_blank())

# Histogram for mean openness (BFI)
ggplot(data_processed_after_exclusions, aes(x = bfi_mean_o)) +
  geom_histogram(binwidth = 1,
                 boundary = 0,
                 fill = viridis_pal(begin = 0.45, option = "mako")(1), 
                 color = viridis_pal(begin = 0.30, option = "mako")(1)) + 
  xlab("Mean Openness") +
  ylab("Frequency") +
  theme_linedraw() +
  scale_x_continuous(breaks = pretty_breaks(n = 5)) +
  ggtitle("Histogram for BFI Openness") +
  coord_cartesian(xlim = c(1, 6)) +
  theme(panel.grid.minor = element_blank())
  
# Histogram for D-score (IAT)
ggplot(data_processed_after_exclusions, aes(x = d_score)) +
  geom_histogram(binwidth = 0.20,
                 boundary = 0,
                 fill = viridis_pal(begin = 0.45, option = "mako")(1), 
                 color = viridis_pal(begin = 0.30, option = "mako")(1)) + 
  xlab("D-score") +
  ylab("Frequency") +
  theme_linedraw() +
  scale_x_continuous(breaks = pretty_breaks(n = 5)) +
  ggtitle("Histogram for IAT D-score") +
  coord_cartesian(xlim = c(-2, 2)) +
  theme(panel.grid.minor = element_blank())

```

### Correlation Matrix IAT - BFI

```{r}

data_processed_after_exclusions |> 
  select(bfi_mean_a, bfi_mean_c, bfi_mean_e, bfi_mean_n, bfi_mean_o, d_score) |> 
  cor(use = "pairwise.complete.obs") |> 
  as.data.frame() |> 
  mutate_all(.funs = round_half_up, digits = 2) |> 
  kable() |>
  kable_classic(full_width = FALSE)

```

# Analyses & Hypothesis Tests

## T-test: Comparing Genders (IAT)

Conduct a two sample t-test for the hypothesis that the D-score differs between female and male.

```{r}

data_processed_after_exclusions |> 
  filter(sex != "missing/error/others") |> 
  with(t.test(d_score ~ sex)) |> 
  report()

```

## Regressions: BFI & IAT

Conduct a linear regression for all BFI facets (independent variable) and the IAT D-score (dependent variable). 

### Agreeableness
```{r}

# Linear regression: Agreeableness
lm(d_score ~ bfi_mean_a, data = data_processed_after_exclusions) |> 
  report()

```


### Conscientiousness

```{r}

# Linear regression: Conscientiousness
lm(d_score ~ bfi_mean_c, data = data_processed_after_exclusions) |> 
  report()

```


### Extroversion

```{r}

# Linear regression: Extroversion
lm(d_score ~ bfi_mean_e, data = data_processed_after_exclusions) |> 
  report()

```


### Neuroticism

```{r}

## Linear regression: Neuroticism
lm(d_score ~ bfi_mean_n, data = data_processed_after_exclusions) |> 
  report()

```


### Openness

```{r}

# Linear regression: Openness
lm(d_score ~ bfi_mean_o, data = data_processed_after_exclusions) |> 
  report()

```


## Plots: IAT and BFI

```{r}

# Scatter plot: Agreeableness
plot_iat_bfi_a <- data_processed_after_exclusions |> 
  mutate(extreme_values = ifelse(between(d_score, quantile(d_score, 0.1), quantile(d_score, 0.9)), "Normal Values", "Extreme Values")) |> 
  ggplot(aes(x = bfi_mean_a, y = d_score, group = extreme_values)) +
  geom_point(aes(shape = extreme_values, color = extreme_values), alpha = 0.8) +
  geom_smooth(aes(group = 1), method = "lm", fullrange = TRUE) +
  scale_x_continuous(breaks = pretty_breaks(n = 6),
                     limits = c(1, 6)) +
  scale_y_continuous(breaks = pretty_breaks(n = 8),
                     limits = c(-2, 2)) +
  xlab("Mean Agreeableness") +
  ylab("D-score") +
  ggtitle("Scatter Plot: Agreeableness and D-score") +
  theme_classic() +
  theme(plot.caption = element_text(hjust = 0),
        legend.position = c(0.9, 0.9)) +
  guides(color = guide_legend("Outliers"),
         shape = guide_legend("Outliers")) +
  scale_shape_manual(values = c(17,16)) +
  scale_color_manual(values = wes_palette("GrandBudapest1", n = 2, type = "continuous"))


# Scatter plot: Conscientiousness
plot_iat_bfi_c <- data_processed_after_exclusions |> 
  mutate(extreme_values = ifelse(between(d_score, quantile(d_score, 0.1), quantile(d_score, 0.9)), "Normal Values", "Extreme Values")) |> 
  ggplot(aes(x = bfi_mean_c, y = d_score, group = extreme_values)) +
  geom_point(aes(shape = extreme_values, color = extreme_values), alpha = 0.8) +
  geom_smooth(aes(group = 1), method = "lm", fullrange = TRUE) +
  scale_x_continuous(breaks = pretty_breaks(n = 6),
                     limits = c(1, 6)) +
  scale_y_continuous(breaks = pretty_breaks(n = 8),
                     limits = c(-2, 2)) +
  xlab("Mean Contientiousness") +
  ylab("D-score") +
  ggtitle("Scatter Plot: Contientiousness and D-score") +
  theme_classic() +
  theme(plot.caption = element_text(hjust = 0),
        legend.position = c(0.9, 0.9)) +
  guides(color = guide_legend("Outliers"),
         shape = guide_legend("Outliers")) +
  scale_shape_manual(values = c(17,16)) +
  scale_color_manual(values = wes_palette("GrandBudapest1", n = 2, type = "continuous"))


# Scatter plot: Extroversion
plot_iat_bfi_e <- data_processed_after_exclusions |> 
  mutate(extreme_values = ifelse(between(d_score, quantile(d_score, 0.1), quantile(d_score, 0.9)), "Normal Values", "Extreme Values")) |> 
  ggplot(aes(x = bfi_mean_e, y = d_score, group = extreme_values)) +
  geom_point(aes(shape = extreme_values, color = extreme_values), alpha = 0.8) +
  geom_smooth(aes(group = 1), method = "lm", fullrange = TRUE) +
  scale_x_continuous(breaks = pretty_breaks(n = 6),
                     limits = c(1, 6)) +
  scale_y_continuous(breaks = pretty_breaks(n = 8),
                     limits = c(-2, 2)) +
  xlab("Mean Extroversion") +
  ylab("D-score") +
  ggtitle("Scatter Plot: Extroversion and D-score") +
  theme_classic() +
  theme(plot.caption = element_text(hjust = 0),
        legend.position = c(0.9, 0.9)) +
  guides(color = guide_legend("Outliers"),
         shape = guide_legend("Outliers")) +
  scale_shape_manual(values = c(17,16)) +
  scale_color_manual(values = wes_palette("GrandBudapest1", n = 2, type = "continuous"))


# Scatter plot: Neuroticism
plot_iat_bfi_n <- data_processed_after_exclusions |> 
  mutate(extreme_values = ifelse(between(d_score, quantile(d_score, 0.1), quantile(d_score, 0.9)), "Normal Values", "Extreme Values")) |> 
  ggplot(aes(x = bfi_mean_n, y = d_score, group = extreme_values)) +
  geom_point(aes(shape = extreme_values, color = extreme_values), alpha = 0.8) +
  geom_smooth(aes(group = 1), method = "lm", fullrange = TRUE) +
  scale_x_continuous(breaks = pretty_breaks(n = 6),
                     limits = c(1, 6)) +
  scale_y_continuous(breaks = pretty_breaks(n = 8),
                     limits = c(-2, 2)) +
  xlab("Mean Neuroticism") +
  ylab("D-score") +
  ggtitle("Scatter Plot: Neuroticism and D-score") +
  theme_classic() +
  theme(plot.caption = element_text(hjust = 0),
        legend.position = c(0.9, 0.9)) +
  guides(color = guide_legend("Outliers"),
         shape = guide_legend("Outliers")) +
  scale_shape_manual(values = c(17,16)) +
  scale_color_manual(values = wes_palette("GrandBudapest1", n = 2, type = "continuous"))


# Scatter plot: Openness
plot_iat_bfi_o <- data_processed_after_exclusions |> 
  mutate(extreme_values = ifelse(between(d_score, quantile(d_score, 0.1), quantile(d_score, 0.9)), "Normal Values", "Extreme Values")) |> 
  ggplot(aes(x = bfi_mean_o, y = d_score, group = extreme_values)) +
  geom_point(aes(shape = extreme_values, color = extreme_values), alpha = 0.8) +
  geom_smooth(aes(group = 1), method = "lm", fullrange = TRUE) +
  scale_x_continuous(breaks = pretty_breaks(n = 6),
                     limits = c(1, 6)) +
  scale_y_continuous(breaks = pretty_breaks(n = 8),
                     limits = c(-2, 2)) +
  xlab("Mean Openness") +
  ylab("D-score") +
  ggtitle("Scatter Plot: Openness and D-score") +
  theme_classic() +
  theme(plot.caption = element_text(hjust = 0),
        legend.position = c(0.9, 0.9)) +
  guides(color = guide_legend("Outliers"),
         shape = guide_legend("Outliers")) +
  scale_shape_manual(values = c(17,16)) +
  scale_color_manual(values = wes_palette("GrandBudapest1", n = 2, type = "continuous"))

```


### Combining and Displaying Plots

```{r, fig.dim = c(12, 8)}

all_scatter_plots <- plot_iat_bfi_a + plot_iat_bfi_c + plot_iat_bfi_e + plot_iat_bfi_n + plot_iat_bfi_o +
  plot_layout(widths = c(1, 1)) +
  plot_annotation(title = "Scatter Plots: IAT and BFI Facets",
                  caption = "Note: Extreme values are defined as the top/bottom 10% of the values.")

print(all_scatter_plots) |> 
  suppressMessages() |> 
  suppressWarnings()

```

### Saving Plots

```{r}

dir.create("../communications/plots")

ggsave("iat_bfi_scatter_plots.png",
       plot = all_scatter_plots,
       width = 15,
       height = 10,
       dpi = 300, 
       path = "../communications/plots")

ggsave("iat_bfi_scatter_plot.pdf",
       plot = all_scatter_plots,
       width = 15,
       height = 10,
       path = "../communications/plots")

```

# Session info

```{r}

sessionInfo()

```